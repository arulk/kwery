--Auto id columns start with 100 to prevent id collision as in this thread http://stackoverflow.com/questions/37410841/the-statement-was-aborted-because-it-would-have-caused-a-duplicate-key
--We insert ids with values for tests

create table kwery_user (
  id integer generated by default as identity (START WITH 100, INCREMENT BY 1),
  password varchar(255) not null,
  username varchar(255) not null,
  primary key (id)
);

create table datasource (
  id integer generated by default as identity (START WITH 100, INCREMENT BY 1),
  label varchar(255) not null,
  password varchar(255),
  port integer not null check (port>=1),
  type varchar(255),
  url varchar(255) not null,
  username varchar(255) not null,
  primary key (id)
);

create table query_run (
  id integer generated by default as identity (START WITH 100, INCREMENT BY 1),
  cron_expression varchar(255) not null,
  label varchar(255) not null,
  query varchar(255) not null,
  datasource_id_fk integer not null,
  primary key (id)
);

create table query_run_execution (
  id integer generated by default as identity (START WITH 100, INCREMENT BY 1),
  execution_end bigint,
  execution_id varchar(255),
  execution_start bigint,
  result long varchar,
  status varchar(255),
  query_run_id_fk integer,
  primary key (id)
);

alter table kwery_user add constraint UK_oi2a6rr9bbna339uej0kywhfy  unique (username);

alter table datasource add constraint UK_2kxqjqmgkpln474giultd222s  unique (label);

alter table query_run add constraint UK_o8o3g7ixjl43k37fvshp3hu8q  unique (label);

alter table query_run add constraint FK_ktt4mf7e34jmw0f0ogm78ouq0 foreign key (datasource_id_fk) references datasource;

alter table query_run_execution add constraint FK_91fufdgwmkr99ayu6eegqqx95 foreign key (query_run_id_fk) references query_run;